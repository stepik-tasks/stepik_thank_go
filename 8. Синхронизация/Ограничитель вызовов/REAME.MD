### ü§î –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å –≤—ã–∑–æ–≤–æ–≤

–ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞—â–∏—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ ‚Äî _–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤_ (rate limiter):

- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º, —Å–∫–∞–∂–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.
- –¢–µ–ø–µ—Ä—å —Å–∫–æ–ª—å–∫–æ –±—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –ø—Ä–∏—Å–ª–∞–ª –∫–ª–∏–µ–Ω—Ç, –∑–∞ —Å–µ–∫—É–Ω–¥—É –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —à—Ç—É–∫. –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–µ—Ä–Ω—É—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

–°–¥–µ–ª–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±–µ—Ä—Ç–∫—É `throttle(limit, fn)`, –∫–æ—Ç–æ—Ä–∞—è —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è fn –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –Ω–µ –±–æ–ª–µ–µ limit —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É:

```go
var ErrBusy = errors.New("busy")
var ErrCanceled = errors.New("canceled")

// throttle —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è fn –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –Ω–µ –±–æ–ª–µ–µ limit —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É.
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ handle (–≤—ã–ø–æ–ª–Ω—è–µ—Ç fn —Å —É—á–µ—Ç–æ–º –ª–∏–º–∏—Ç–∞) –∏ cancel (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å).
func throttle(limit int, fn func()) (handle func() error, cancel func()) {
    // ...
}

func main() {
    work := func() {
        fmt.Print(".")
    }

    handle, cancel := throttle(5, work)
    defer cancel()

    const n = 8
    var nOK, nErr int
    for i := 0; i < n; i++ {
        err := handle()
        if err == nil {
            nOK += 1
        } else {
            nErr += 1
        }
    }
    fmt.Println()
    fmt.Printf("%d calls: %d OK, %d busy\n", n, nOK, nErr)
}
```

–í –ø—Ä–∏–º–µ—Ä–µ `handle` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 8 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥, –Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—é —Ñ—É–Ω–∫—Ü–∏—è `work` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5 —Ä–∞–∑. 
–í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö handle –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `ErrBusy`:

```go
.....
8 calls: 5 OK, 3 busy
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω—é–∞–Ω—Å—ã:

- –ò `handle`, –∏ `cancel` –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω.
- `fn` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–≤ —Ç–æ–π –∂–µ –≥–æ—Ä—É—Ç–∏–Ω–µ, —á—Ç–æ –≤—ã–∑–≤–∞–ª–∞ `handle`).
- `handle` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–∞ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å `cancel`. –¢–æ–≥–¥–∞ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É `ErrCanceled`.
- `cancel` –¥–æ–ª–∂–Ω–∞ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –∑–∞–Ω—è—Ç—ã–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–µ–º (–µ—Å–ª–∏ —Ç–∞–∫–∏–µ –µ—Å—Ç—å).
- `cancel` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –¢–æ–≥–¥–∞ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å, 
–∞ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.
