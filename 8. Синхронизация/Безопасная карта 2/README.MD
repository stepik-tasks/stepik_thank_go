### ü§î –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–∞—Ä—Ç–∞

–Ø —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ç–∏–ø `ConcMap` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∫–∞—Ä—Ç—É –¥–ª—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ–π —Å—Ä–µ–¥—ã:

```go
// ConcMap - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ–π —Å—Ä–µ–¥–µ –∫–∞—Ä—Ç–∞.
type ConcMap[K comparable, V any] struct {
    items map[K]V
    lock  sync.Mutex
}

// NewConcMap —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É.
func NewConcMap[K comparable, V any]() *ConcMap[K, V] {
    return &ConcMap[K, V]{items: map[K]V{}}
}
```

–£ –∫–∞—Ä—Ç—ã –µ—Å—Ç—å –¥–≤–µ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî `Get` –∏ `Set`:

```go
// Get –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É.
func (cm *ConcMap[K, V]) Get(key K) V {
    cm.lock.Lock()
    defer cm.lock.Unlock()
    return cm.items[key]
}

// Set —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É.
func (cm *ConcMap[K, V]) Set(key K, val V) {
    cm.lock.Lock()
    defer cm.lock.Unlock()
    cm.items[key] = val
}
```

–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –ø–∞—Ä–æ—á–∫—É.

‚ûä `SetIfAbsent` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ, 
–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–∞–∫–æ–≥–æ –∫–ª—é—á–∞ –Ω–µ—Ç –≤ –∫–∞—Ä—Ç–µ. –ï—Å–ª–∏ –∫–ª—é—á —É–∂–µ –µ—Å—Ç—å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 
—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É:

```go
var wg sync.WaitGroup
wg.Add(2)

m := NewConcMap[string, int]()

go func() {
    defer wg.Done()
    time.Sleep(5 * time.Millisecond)
    m.SetIfAbsent("hello", 42)
}()

go func() {
    defer wg.Done()
    time.Sleep(10 * time.Millisecond)
    m.SetIfAbsent("hello", 84)
}()

wg.Wait()
fmt.Println("hello =", m.Get("hello"))
// hello = 42 (–æ—Ç –ø–µ—Ä–≤–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã)
```

‚ûã `Compute` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É, –ø—Ä–∏–º–µ–Ω—è—è –∫ –Ω–µ–º—É —Ñ—É–Ω–∫—Ü–∏—é. –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ:

```go
var wg sync.WaitGroup
wg.Add(2)

m := NewConcMap[string, int]()

go func() {
    defer wg.Done()
    for range 100 {
        m.Compute("hello", func(v int) int {
            return v + 1
        })
    }
}()

go func() {
    defer wg.Done()
    for range 100 {
        m.Compute("hello", func(v int) int {
            return v + 1
        })
    }
}()

wg.Wait()
fmt.Println("hello =", m.Get("hello"))
// hello = 200 (–∫–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ —É–≤–µ–ª–∏—á–∏–ª–∞ hello –Ω–∞ 100)
```

–†–µ–∞–ª–∏–∑—É–π—Ç–µ `SetIfAbsent` –∏ `Compute`.

